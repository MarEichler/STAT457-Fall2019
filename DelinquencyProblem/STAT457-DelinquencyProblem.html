
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="https://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="https://yihui.name/knitr/"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.24</code>)
    .</p>

<div class="chunk" id="auto-report"><div class="rcode"><div class="source"><pre class="knitr r">---
<span class="hl com">#title: STAT 457 Delinquency Problem </span>
<span class="hl com">#author: Martha Eichlersmith</span>
output:
  pdf_document:
    fig_caption: yes
header-includes:
  - \usepackage{color}
  - \usepackage{mathtools}
  - \usepackage{amsbsy} <span class="hl com">#bold <span class="hl kwa">in</span> mathmode</span>
  - \usepackage{nicefrac} <span class="hl com"># <span class="hl kwa">for</span> nice fracs </span>
  - \usepackage{booktabs}
  - \usepackage{geometry}
  - \usepackage{caption} <span class="hl com">#to remove automatic table name and number - \captionsetup[table]{labelformat=empty}, put code under ---</span>
  - \usepackage{lastpage} <span class="hl com">#<span class="hl kwa">for</span> pageref*{LastPage} - to get total # of pages</span>
  - \usepackage{fancyhdr}
  - \pagestyle{fancy}
  - \fancyhf{}
  - \fancyhead[L]{STAT 457 Fall 2019 \\ Delinquency Problem}
  - \fancyhead[R]{Martha Eichlersmith \\ Page \thepage\ of\ \pageref*{LastPage}}  
  - \setlength{\headheight}{22.5pt} <span class="hl com">#to remove \fancyhead error <span class="hl kwa">for</span> head height</span>
#left-even <span class="hl kwd">pages</span> (LE) right-odd <span class="hl kwd">pages</span> (RE)
geometry: <span class="hl str">&quot;left=0.75in,right=0.75in,top=1.1in,bottom=1in&quot;</span> 

---

\captionsetup[table]{labelformat=empty}
```{r setup, echo=<span class="hl kwa">FALSE</span>, results=<span class="hl str">&quot;hide&quot;</span>, warning=<span class="hl kwa">FALSE</span>, message=<span class="hl kwa">FALSE</span>}
<span class="hl kwd">library</span>(ggplot2) #ggplot
<span class="hl kwd">library</span>(readr) #import CSV
<span class="hl kwd">library</span>(gridExtra) #organize plots
<span class="hl kwd">library</span>(grid) #organize plots
<span class="hl kwd">library</span>(latex2exp) #latex <span class="hl kwa">in</span> ggplot titles 
<span class="hl kwd">library</span>(gtable) #<span class="hl kwa">for</span> tablegrob functions 
#<span class="hl kwd">library</span>(kableExtra) #<span class="hl kwa">for</span> kable functions
<span class="hl kwd">library</span>(dplyr) #<span class="hl kwa">for</span> piping 
<span class="hl kwd">library</span>(MCMCpack) #<span class="hl kwa">for</span> dirichelt
knitr::opts_chunk$<span class="hl kwd">set</span>(fig.width = 10, fig.height = 4)
knitr::opts_chunk$<span class="hl kwd">set</span>(echo=<span class="hl kwa">FALSE</span>)
decimal &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(x, k) <span class="hl kwd">trimws</span>(<span class="hl kwd">format</span>(<span class="hl kwd">round</span>(x, k), nsmall=k))
dec &lt;- 3
#knitr::opts_chunk$<span class="hl kwd">set</span>(echo=<span class="hl kwa">FALSE</span>) #using knitr <span class="hl kwa">for</span> this option but don't have to load 
```

<span class="hl com"># Is my little brother a delinquent? </span>

```{r Counts}
alpha &lt;-  <span class="hl kwd">c</span>(127, 123, 93, 17) #most delinquent
gamma &lt;-  <span class="hl kwd">c</span>(345, 209, 158, 65)  #least delinquent

table &lt;- <span class="hl kwd">rbind</span>( alpha, gamma)
<span class="hl kwd">rownames</span>(table) &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Most Delinquent&quot;</span>, <span class="hl str">&quot;Least Delinquent&quot;</span>)
<span class="hl kwd">colnames</span>(table) &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Oldest&quot;</span>, <span class="hl str">&quot;In-between&quot;</span>, <span class="hl str">&quot;Youngest&quot;</span>, <span class="hl str">&quot;Only Child&quot;</span>)

knitr::<span class="hl kwd">kable</span>(table, booktabs=<span class="hl kwa">TRUE</span>, <span class="hl str">'latex'</span>, digits=dec, caption=<span class="hl str">&quot;Raw Data&quot;</span>) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;hold_position&quot;</span> ) 
```
Using the above data, we want to know <span class="hl kwa">if</span> birth order affects delinquency <span class="hl kwa">in</span> boys.  Looking at the raw data row proportions it appears that the oldest and only-child sons have a lower delinquency level, where as middle and youngest sons have a higher delinquency levels.   
```{r func_tableparam}
<span class="hl com">#FUNCTION: PUT PARAMETERS INTO TABLE</span>
func_tableparam &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(parameters, name){
diff &lt;- parameters[1,]- parameters[2,]
table &lt;- <span class="hl kwd">rbind</span>( parameters, diff)
<span class="hl kwd">rownames</span>(table) &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Most Delinquent&quot;</span>, <span class="hl str">&quot;Least Delinquent&quot;</span>, <span class="hl str">&quot;<span class="hl kwd">Difference</span> (Most - Least)&quot;</span>)
<span class="hl kwd">colnames</span>(table) &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Oldest&quot;</span>, <span class="hl str">&quot;In-between&quot;</span>, <span class="hl str">&quot;Youngest&quot;</span>, <span class="hl str">&quot;Only Child&quot;</span>)
knitr::<span class="hl kwd">kable</span>(table, booktabs=<span class="hl kwa">TRUE</span>, <span class="hl str">'latex'</span>, digits=dec, caption=<span class="hl kwd">paste</span>(name)) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;hold_position&quot;</span> ) 
}

<span class="hl kwd">func_tableparam</span>(<span class="hl kwd">rbind</span>(alpha/<span class="hl kwd">sum</span>(alpha), gamma/<span class="hl kwd">sum</span>(gamma)), <span class="hl str">&quot;Row Proportions&quot;</span>)
```


\newpage 
<span class="hl com">## Bayesian</span>


```{r func_values}
<span class="hl com">#FUNCTION: RETURN IT, MEAN, CI, AND PVALUE </span>
func_values &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(vec){
  it &lt;- <span class="hl kwd">length</span>(vec)
  CI.val &lt;- <span class="hl kwd">decimal</span>(<span class="hl kwd">quantile</span>(vec, <span class="hl kwd">c</span>(0.025, 0.975)), dec)
  CI.95 &lt;- <span class="hl kwd">paste</span>(<span class="hl str">&quot;(&quot;</span>, <span class="hl kwd">paste</span>(CI.val, collapse=<span class="hl str">&quot;, &quot;</span>), <span class="hl str">&quot;)&quot;</span>)
  mean &lt;- <span class="hl kwd">decimal</span>(<span class="hl kwd">mean</span>(vec), dec)
  pval &lt;- <span class="hl kwd">decimal</span>(<span class="hl kwd">min</span>(<span class="hl kwd">length</span>(vec[vec &gt; 0])/it, 1 - <span class="hl kwd">length</span>(vec[vec &gt; 0])/it), dec)
  vec &lt;- <span class="hl kwd">c</span>(it, mean, CI.95, pval)
  vec
}
```
```{r func_delinq}
<span class="hl com">#FUNCTION: SIMIULATE VALUES </span>
func_delinq &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(it, alpha, gamma){
<span class="hl kwd">set.seed</span>(050104)
prop.alpha &lt;- <span class="hl kwd">rdirichlet</span>(it, alpha)
prop.gamma &lt;- <span class="hl kwd">rdirichlet</span>(it, gamma)
diff &lt;- <span class="hl kwd">cbind</span>( #most - least
   prop.alpha[,1] - prop.gamma[,1] <span class="hl com">#diff <span class="hl kwa">for</span> Oldest</span>
  ,prop.alpha[,2] - prop.gamma[,2] <span class="hl com">#diff <span class="hl kwa">for</span> in-between</span>
  ,prop.alpha[,3] - prop.gamma[,3] <span class="hl com">#diff <span class="hl kwa">for</span> youngest</span>
  ,prop.alpha[,4] - prop.gamma[,4] <span class="hl com">#diff <span class="hl kwa">for</span> only-child</span>
   )
<span class="hl kwd">apply</span>(diff, 2, func_values)
}
```
```{r func_table}
<span class="hl com">#FUNCTION: put into a table </span>
func_table &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(i, name, it.1, it.2, it.3){
table &lt;- <span class="hl kwd">cbind</span>(it.1[,i], it.2[,i] , it.3[,i])
<span class="hl kwd">rownames</span>(table) &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Iterations&quot;</span>, <span class="hl str">&quot;Mean&quot;</span>, <span class="hl str">&quot;95% CI&quot;</span>, <span class="hl str">&quot;pval&quot;</span>)
title &lt;- <span class="hl kwd">paste</span>(<span class="hl str">&quot;Difference <span class="hl kwa">in</span> Proportion <span class="hl kwa">for</span>&quot;</span>, name, <span class="hl str">&quot;: Most Delinquent - Least Delinquent&quot;</span>)

knitr::<span class="hl kwd">kable</span>(table, booktabs=<span class="hl kwa">TRUE</span>, <span class="hl str">'latex'</span>, digits=dec, caption=<span class="hl kwd">paste</span>(title)) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;hold_position&quot;</span> ) 
}
```
```{r func_chisq}
<span class="hl com">#FUNCTION: CHI SQUARE - COMBINING P-VALUES </span>
func_pval.chisq &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(pvals){
  x &lt;- -2*<span class="hl kwd">sum</span>(<span class="hl kwd">log</span>(<span class="hl kwd">as.numeric</span>(pvals)))
  combined.pval &lt;-  1- <span class="hl kwd">pchisq</span>(x, 2*<span class="hl kwd">length</span>(pvals))
}
```
```{r func_combinedpval}
<span class="hl com">#FUNCTION: COMBINE THE P-VALUES INTO TABLE </span>
func_combinedpval &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(it.1, it.2, it.3){
pvals.matrix &lt;- <span class="hl kwd">cbind</span>(  <span class="hl kwd">as.numeric</span>(it.1[4,])
                      , <span class="hl kwd">as.numeric</span>(it.2[4,])
                      , <span class="hl kwd">as.numeric</span>(it.3[4,])
)

combined &lt;- <span class="hl kwd">apply</span>(pvals.matrix, 2, func_pval.chisq)
combined.pvals &lt;- <span class="hl kwd">rbind</span>(it.vec, <span class="hl kwd">decimal</span>(combined, 10))
<span class="hl kwd">rownames</span>(combined.pvals) &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Iterations&quot;</span>, <span class="hl str">&quot;Combined p-value&quot;</span>)

title &lt;- <span class="hl kwd">paste</span>(<span class="hl str">&quot;Combined p-values:&quot;</span>,<span class="hl str">&quot;$X = -2\\sum_{i=1}^<span class="hl kwd">4</span>(p_i) \\sim \\chi^2_{df=8}$&quot;</span>)
knitr::<span class="hl kwd">kable</span>(combined.pvals, booktabs=<span class="hl kwa">TRUE</span>, <span class="hl str">'latex'</span>, caption=<span class="hl kwd">paste</span>(title)) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;hold_position&quot;</span> ) 
}
```
```{r bayesRESULTS}

it.vec &lt;- <span class="hl kwd">c</span>(1e04, 1e05, 1e06)
it1 &lt;- <span class="hl kwd">func_delinq</span>(it.vec[1], alpha, gamma)
it2 &lt;- <span class="hl kwd">func_delinq</span>(it.vec[2], alpha, gamma)
it3 &lt;- <span class="hl kwd">func_delinq</span>(it.vec[3], alpha, gamma)

<span class="hl kwd">func_table</span>(1, <span class="hl str">&quot;Oldest&quot;</span>, it1, it2, it3)
<span class="hl kwd">func_table</span>(2, <span class="hl str">&quot;In-Between&quot;</span>, it1, it2, it3)
<span class="hl kwd">func_table</span>(3, <span class="hl str">&quot;Youngest&quot;</span>, it1, it2, it3)
<span class="hl kwd">func_table</span>(4, <span class="hl str">&quot;Only&quot;</span>, it1, it2, it3)
<span class="hl kwd">func_combinedpval</span>(it1, it2, it3)
```
Using simulations, the results support the hypothesis that delinquency levels are higher <span class="hl kwa">in</span> middle and younger sons but lower <span class="hl kwa">in</span> oldest and only sons.  

\newpage 
<span class="hl com">## Frequentest Tests</span>
<span class="hl com">### Proportion Test <span class="hl kwa">for</span> Specific Birth Order </span>

```{r func_proptest}
func_proptest &lt;- <span class="hl kwd"><span class="hl kwa">function</span></span>(c, alt, name){
table2x2 &lt;- <span class="hl kwd">matrix</span>(<span class="hl kwd">c</span>(alpha[c], <span class="hl kwd">sum</span>(alpha), gamma[c], <span class="hl kwd">sum</span>(gamma)), nrow=2, byrow=<span class="hl kwa">TRUE</span>)
test &lt;- <span class="hl kwd">prop.test</span>(table2x2, alternative=alt)
X.squared &lt;- <span class="hl kwd">decimal</span>(test$statistic, dec)
p.value &lt;- <span class="hl kwd">decimal</span>(test$p.value, dec)
alternative &lt;- test$alternative
results &lt;- <span class="hl kwd">cbind</span>(X.squared, p.value, alternative)
<span class="hl kwd">rownames</span>(results) &lt;-<span class="hl kwd">c</span>(<span class="hl str">&quot;&quot;</span>)
title &lt;- <span class="hl kwd">paste</span>(<span class="hl str">&quot;Difference <span class="hl kwa">in</span> Proportion <span class="hl kwa">for</span>&quot;</span>, name, <span class="hl str">&quot;: Most Delinquent - Least Delinquent&quot;</span>)
knitr::<span class="hl kwd">kable</span>(results, booktabs=<span class="hl kwa">TRUE</span>, <span class="hl str">'latex'</span>, caption=<span class="hl kwd">paste</span>(title)) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;hold_position&quot;</span> ) 
}
```

```{r freqRESULTS1}
<span class="hl kwd">func_proptest</span>(1, <span class="hl str">'less'</span>,<span class="hl str">&quot;Only&quot;</span>)
<span class="hl kwd">func_proptest</span>(2, <span class="hl str">'greater'</span>,<span class="hl str">&quot;Only&quot;</span>)
<span class="hl kwd">func_proptest</span>(3, <span class="hl str">'greater'</span>,<span class="hl str">&quot;Only&quot;</span>)
<span class="hl kwd">func_proptest</span>(4, <span class="hl str">'less'</span>,<span class="hl str">&quot;Only&quot;</span>)
```



<span class="hl com">### Chi-Sq test <span class="hl kwa">for</span> Independence </span>
```{r freqRESULTS2}
parameters &lt;- <span class="hl kwd">rbind</span>(alpha, gamma)
<span class="hl kwd">chisq.test</span>(parameters)
```

Using traditional frequentest test, the results are the same: delinquency levels are higher <span class="hl kwa">in</span> middle and younger sons but lower <span class="hl kwa">in</span> oldest and only sons.  

<span class="hl com">## Conclusion</span>
Using the data provided, there is strong evidence that younger sons are more likely to be a delinquent.  So even though my brother is not is a delinquent, there is a higher probably that he will become one.  


```{r}
<span class="hl com">#PRINTING THE CODE</span>
#knitr::<span class="hl kwd">stitch</span>(<span class="hl str">&quot;HW06.Rmd&quot;</span>) to go to latex
knitr::<span class="hl kwd">stitch</span>(   script=<span class="hl str">&quot;DelinquencyProblem.Rmd&quot;</span>  , <span class="hl kwd">system.file</span>(<span class="hl str">&quot;misc&quot;</span>, <span class="hl str">&quot;knitr-template.Rhtml&quot;</span>, package=<span class="hl str">&quot;knitr&quot;</span>)) #code to HTML
```
</pre></div>
<div class="error"><pre class="knitr r">## Error: &lt;text&gt;:8:5: unexpected input
## 7: header-includes:
## 8:   - \
##        ^
</pre></div>
</div></div>

  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r">    <span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.6.1 (2019-07-05)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17763)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] invgamma_1.1        MCMCpack_1.4-4      MASS_7.3-51.4       coda_0.19-3        
##  [5] gtable_0.3.0        numDeriv_2016.8-1.1 matlib_0.9.2        readr_1.3.1        
##  [9] dplyr_0.8.3         latex2exp_0.4.0     gridExtra_2.3       ggplot2_3.2.1      
## [13] knitr_1.24         
## 
## loaded via a namespace (and not attached):
##  [1] httr_1.4.1              jsonlite_1.6            viridisLite_0.3.0      
##  [4] carData_3.0-2           shiny_1.3.2             assertthat_0.2.1       
##  [7] highr_0.8               cellranger_1.1.0        yaml_2.2.0             
## [10] pillar_1.4.2            backports_1.1.4         lattice_0.20-38        
## [13] quantreg_5.51           glue_1.3.1              digest_0.6.20          
## [16] manipulateWidget_0.10.0 promises_1.0.1          rvest_0.3.4            
## [19] colorspace_1.4-1        htmltools_0.3.6         httpuv_1.5.1           
## [22] Matrix_1.2-17           pkgconfig_2.0.2         SparseM_1.77           
## [25] haven_2.1.1             purrr_0.3.2             xtable_1.8-4           
## [28] scales_1.0.0            webshot_0.5.1           openxlsx_4.1.0.1       
## [31] later_0.8.0             rio_0.5.16              MatrixModels_0.4-1     
## [34] tibble_2.1.3            car_3.0-3               withr_2.1.2            
## [37] lazyeval_0.2.2          magrittr_1.5            crayon_1.3.4           
## [40] readxl_1.3.1            mime_0.7                mcmc_0.9-6             
## [43] evaluate_0.14           forcats_0.4.0           xml2_1.2.2             
## [46] foreign_0.8-71          tools_3.6.1             data.table_1.12.4      
## [49] hms_0.5.0               stringr_1.4.0           munsell_0.5.0          
## [52] zip_2.0.4               kableExtra_1.1.0        compiler_3.6.1         
## [55] rlang_0.4.0             rstudioapi_0.10         htmlwidgets_1.5.1      
## [58] crosstalk_1.0.0         miniUI_0.1.1.1          labeling_0.3           
## [61] rmarkdown_1.14          abind_1.4-5             curl_4.2               
## [64] R6_2.4.0                zeallot_0.1.0           stringi_1.4.3          
## [67] Rcpp_1.0.2              vctrs_0.2.0             rgl_0.100.30           
## [70] tidyselect_0.2.5        xfun_0.8
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;2019-12-09 17:46:27 CST&quot;
</pre></div>
</div></div>


</body>
</html>
